import streamlit as st
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()

# ----------------------
# 1) 페이지 및 제목 설정
# ----------------------
st.set_page_config(page_title="창업자 자가진단")
st.title("AI를 활용한 창업자 자가진단 및 성장전략 도출")

st.markdown("""
**단국대 창업지원단**은 '초기창업패키지' 참여 사업체를 대상으로 역량진단 및 발전방안 도출을 위한 설문을 진행합니다.  
본 설문은 창업역량 분석과 발전방안 모색을 위한 자료로만 활용되며, 모든 개인정보는 철저히 보호됩니다.
""")

# ----------------------
# 2) 도메인(E/R/I/S) 분류 사전 설정
#    (각 질문별로 어떤 영역인지를 기록)
# ----------------------

# (A) 창업자역량(2번 섹션)
ceo_domain_map = {
    "ceo_q1": "E",  # 나는 평소 자발적으로 계획을 ~
    "ceo_q2": "E",  # 나의 의견을 사람들에게 설명~
    "ceo_q3": "E",  # 유사업종 재직경험
    "ceo_q4": "E",  # 기술/노하우 확보 방안
    "ceo_q5": "E",  # 마케팅 능력
    "ceo_q6": "R",  # 사업화 인력(팀)확보 -> 회사 인적자원
    "ceo_q7": "E",  # 세제 지원제도 지식
    "ceo_q8": "E",  # 회계/재무 지식
    "ceo_q9": "E",  # 자금 확보방안
}

# (B) 시장기회(3번 섹션)
market_domain_map = {
    "market_q1": "I",   # 유사 제품 출시 가능성
    "market_q2": "I",   # 법제도적 환경 변화
    "market_q3": "I",   # 소비자 트렌드
    "market_q4": "I",   # 경제적 변화
    "market_q5": "I",   # 시장규모
    "market_q6": "I",   # 시장성장률
    "market_q7": "I",   # 예상고객 만남
    "market_q8": "I",   # 예상유통업자 만남
    "market_q9": "I",   # 경쟁업체 접촉
    "market_q10": "I",  # 시제품생산 업체와 만남
    "market_q11": "S",  # 목표고객층 결정 -> 전략(마케팅)
    "market_q12": "S",  # 핵심고객 확보 -> 전략(실행성과)
}

# (C) 아이템분석(4번 섹션)
item_domain_map = {
    "item_q1": "R",   # 경쟁자가 모방 어렵다 -> 자원(IP, 기술)
    "item_q2": "R",   # 시제품개발 -> 기술자원
    "item_q3": "R",   # 가격 경쟁력 -> 자원(원가우위)
    "item_q4": "R",   # 기능/성능 개선 -> 자원(제품력)
    "item_q5": "R",   # 개선 가능한 핵심기술 -> 자원(기술)
    "item_q6": "S",   # 후속 제품 계획 -> 미래전략
    "item_q7": "E",   # 유사제품 생산경험 -> 창업가 특수역량
    "item_q8": "E",   # 기술 트렌드 파악 -> 창업가 지식
    "item_q9": "R",   # 기술협력파트너 -> 외부 협력자원
    "item_q10": "S",  # 고객 늘릴 방법 -> 마케팅 전략
    "item_q11": "S",  # 고객이 누구인지 -> 시장 세분화(전략)
    "item_q12": "S",  # 고객 문제점 파악 -> 차별화전략
    "item_q13": "S",  # 추가 혜택 제공 -> 가치제안(전략)
}

# (D) 비즈니스모델(5번 섹션)
bm_domain_map = {
    "bm_q1": "S",  # 경쟁자 BM 분석
    "bm_q2": "S",  # 우리 BM(돈 버는 방법)
    "bm_q3": "S",  # 수익원(판매/수수료) 인지
    "bm_q4": "R",  # 제품생산 협력파트너 -> 자원
    "bm_q5": "R",  # 생산과정 파악 -> 내부 자원(프로세스 지식)
}

# (E) 전략(6번 섹션)
strategy_domain_map = {
    "strategy_q1": "S",  # 생산수량 결정 -> 전략(운영)
    "strategy_q2": "S",  # 외주업체 결정 -> 운영전략
    "strategy_q3": "S",  # 애로사항 파악 -> 리스크 전략
    "strategy_q4": "R",  # 자문 네트워크 -> 외부자원
    "strategy_q5": "R",  # 참여인력 역할/책임 -> 내부 조직자원
    "strategy_q6": "S",  # 향후 2년 매출 예측 -> 재무전략
    "strategy_q7": "S",  # 유통경로 인지 -> 유통전략
    "strategy_q8": "S",  # 수익구조 명확 -> BM/전략
    "strategy_q9": "S",  # 자금운용계획 -> 재무전략
}

# 모든 도메인 맵을 하나로 합침
domain_map = {}
domain_map.update(ceo_domain_map)
domain_map.update(market_domain_map)
domain_map.update(item_domain_map)
domain_map.update(bm_domain_map)
domain_map.update(strategy_domain_map)

# 문항(키)별 질문 텍스트를 저장해두면, 1점/5점 문항 표시할 때 활용
question_texts = {
    # ceo
    "ceo_q1": "나는 평소 자발적으로 계획을 세워서 수행한다.",
    "ceo_q2": "나의 의견을 사람들(고객, 투자자 등)에게 설명할 수 있다.",
    "ceo_q3": "나는 사업아이템과 관련된 유사업종에 재직경험이 있다.",
    "ceo_q4": "나는 사업화를 위한 기술/Know-how 확보 방안이 있다.",
    "ceo_q5": "나는 사업화를 위한 마케팅 능력(판로, 홍보 등)을 확보하고 있다.",
    "ceo_q6": "나는 사업화에 필요한 인력(팀)을 확보하고 있다.",
    "ceo_q7": "나는 창업기업에 대한 법인세 등 세제 지원제도를 알고 있다.",
    "ceo_q8": "나는 자금관리(회계, 재무)지식을 가지고 있다.",
    "ceo_q9": "나는 사업화를 위한 자금 확보방안이 있다.",

    # market
    "market_q1": "유사 제품이 새롭게 출시될 가능성이 있다.",
    "market_q2": "제품과 관련된 법·제도적 환경변화가 내 사업에 유리하다.",
    "market_q3": "제품과 관련된 소비자 트렌드 변화가 내 사업에 유리하다.",
    "market_q4": "제품과 관련된 경제적 변화가 내 사업에 유리하다.",
    "market_q5": "사업아이템 출시시장의 현재 추정규모는 얼마인지 알고있다.",
    "market_q6": "사업아이템 출시 시장의 기대되는 연평균성장률(향후 3년)은 얼마인지 알고 있다.",
    "market_q7": "나는 사업아이템과 관련된 예상고객과 만난 경험이 있다.",
    "market_q8": "나는 사업아이템과 관련된 예상유통업자와 만난 경험이 있다.",
    "market_q9": "나는 사업아이템과 관련된 경쟁업체와 접촉(전화, 이메일, 방문 등)한 적이 있다.",
    "market_q10": "나는 사업아이템과 관련된 시제품생산 업체와 만난 적이 있다.",
    "market_q11": "내 제품을 구매해줄 목표고객층을 결정하였다.",
    "market_q12": "내 제품을 구매해줄 핵심고객을 확보하였다(혹은 알고 있다).",

    # item
    "item_q1": "나의 제품은 경쟁자가 모방하기 어렵다.",
    "item_q2": "나는 판매목적의 시제품개발을 진행하고 있다.",
    "item_q3": "나의 제품은 기존 제품보다 가격 경쟁력이 있다.",
    "item_q4": "나의 제품은 기존 제품의 기능이나 성능을 개선하고 있다.",
    "item_q5": "나는 기존 제품의 기능이나 성능을 개선할 수 있는 핵심기술을 가지고 있다.",
    "item_q6": "나는 후속 제품을 만들 계획이 있다.",
    "item_q7": "나는 제품과 유사한 제품의 생산경험이 있다.",
    "item_q8": "나는 기술 발전의 트렌드(로드맵)를 알고 있다.",
    "item_q9": "나는 기술협력파트너를 확보하고 있다.",
    "item_q10": "나는 고객을 늘릴 수 있는 방법을 알고 있다.",
    "item_q11": "나는 고객이 누구인지 알고 있다.",
    "item_q12": "나는 고객이 느끼는 제품의 문제점을 파악하고 있다.",
    "item_q13": "나는 고객이 받는 기존 제품에 비해 추가적인 혜택을 제공하고 있다.",

    # bm
    "bm_q1": "나는 경쟁자가 어떤 방식으로 돈을 벌고 있는지를 알고 있다.",
    "bm_q2": "나는 나의 사업아이템이 어떤 방식으로 돈을 벌 수 있는지 알고 있다.",
    "bm_q3": "수익을 발생시키는 원천(제품판매, 서비스판매(수수료) 등)을 알고 있다.",
    "bm_q4": "나는 제품생산관련 협력파트너를 확보하고 있다.",
    "bm_q5": "제품 생산과정을 전체적으로 파악하고 있다.",

    # strategy
    "strategy_q1": "제품을 생산할 때 생산할 수량을 결정하였다.",
    "strategy_q2": "제품생산을 대행할 외주업체를 결정하였다.",
    "strategy_q3": "생산과정에서 발생할 수 있는 애로사항을 파악하고 있다.",
    "strategy_q4": "회사운영시 자문을 받을 수 있는 인적 네트워크를 충분히 확보하고 있다.",
    "strategy_q5": "참여인력의 역할과 책임은 명확히 설정되어 있다.",
    "strategy_q6": "향후 2년간 분기별 매출액을 예측하고 있다.",
    "strategy_q7": "유통경로(중간유통, 직접판매 등)를 잘 알고 있다.",
    "strategy_q8": "제품 판매에 따른 수익구조(판매, 수수료, 이용료, 회비 등)는 명확하다.",
    "strategy_q9": "자금운용계획은 수립되어 있다."
}

# ----------------------
# 3) 설문 폼 구성
# ----------------------
with st.form("startup_diagnosis_form"):
    st.header("1. 기본 정보 입력")
    
    # 기본 정보 입력
    col1, col2 = st.columns(2)
    with col1:
        name = st.text_input("귀하의 이름(기업명)*")
        birth_year = st.number_input("출생연도*", min_value=1970, max_value=2025, step=1)
        gender = st.selectbox("성별*", ["남성", "여성", "기타"])
        
    with col2:
        major = st.text_input("전공*")
        education = st.selectbox("학력*", ["중학교이하", "고등학교", "대학(전문학사)", "대학교(학사)", "대학원(석사)", "대학원(박사)", "기타"])
        startup_exp = st.number_input("창업경험(횟수)*", min_value=0, step=1)

    # 창업 관련 정보
    st.subheader("창업 관련 정보")
    gov_support_exp = st.radio(
        "2024년 초기창업패키지 이전 정부창업지원사업 경험 여부*",
        ["없음", "있음"]
    )
    
    if gov_support_exp == "있음":
        support_details = st.text_input("창업지원사업 명칭 및 지원연도")
        
    business_model = st.selectbox("비즈니스 모델 유형*", [
        "B2B", "B2C", "B2G", "C2C", "O2O"
    ])

    startup_item = st.text_input("창업아이템*")
    
    # 창업단계
    st_stage = st.selectbox("창업단계*", [
            "창업준비단계(아이템선정, 사업타당성분석 등)",
            "창업실행단계(인허가, 법인설립, 자금조달, 설비도입 등)", 
            "창업성장단계(인사조직, 생산관리, 마케팅, 경영관리 등)"
        ])
    
    col3, col4 = st.columns(2)
    with col3:
        startup_field = st.multiselect("창업분야*", [
            "교육", "문화", "환경", "에너지", "안전", "의료",
            "복지", "농림", "수산", "식품", "정보통신", "부품", "소재", "기타"
        ])
        
    with col4:
        ip_status = st.multiselect("지식재산권 상태", [
            "미출원", "출원중", "등록완료", "거절"
        ])

    # 투자 및 멘토링 정보
    investment = st.radio("민간 및 공공투자 여부", ["고려하지 않음", "투자 준비중", "투자 완료"])
    mentoring_needs = st.multiselect("멘토링 요구사항(복수 선택 가능)", [
        "아이디어 구체화", "지식재산권리화", "시제품제작", "사업화전략",
        "사업계획서 작성", "재무, 회계", "마케팅", "자금", "해외진출",
        "지식재산권활용", "가치평가/기술이전", "유통/전자상거래",
        "법률/정책/인증/인프라", "기타"
    ])

    # ------------------
    # [역량 평가 섹션]
    # ------------------
    st.header("2. 창업자 역량 평가 (1~5점)")
    st.caption("각 문항에 대해 **1점(매우 아니다)** ~ **5점(매우 그렇다)** 중 선택")
    
    # (A) 창업자역량
    st.subheader("A) 창업자역량")
    ceo_questions = [
        "나는 평소 자발적으로 계획을 세워서 수행한다.",        # ceo_q1
        "나의 의견을 사람들(고객, 투자자 등)에게 설명할 수 있다.", # ceo_q2
        "나는 사업아이템과 관련된 유사업종에 재직경험이 있다.",  # ceo_q3
        "나는 사업화를 위한 기술/Know-how 확보 방안이 있다.",   # ceo_q4
        "나는 사업화를 위한 마케팅 능력(판로, 홍보 등)을 확보하고 있다.",  # ceo_q5
        "나는 사업화에 필요한 인력(팀)을 확보하고 있다.",        # ceo_q6 -> R
        "나는 창업기업에 대한 법인세 등 세제 지원제도를 알고 있다.", # ceo_q7
        "나는 자금관리(회계, 재무)지식을 가지고 있다.",        # ceo_q8
        "나는 사업화를 위한 자금 확보방안이 있다."             # ceo_q9
    ]

    ceo_scores = {}
    for i, q in enumerate(ceo_questions, start=1):
        ceo_scores[f"ceo_q{i}"] = st.radio(q, [1, 2, 3, 4, 5], index=2, key=q)

    # (B) 시장기회
    st.subheader("B) 시장기회")
    market_questions = [
        "유사 제품이 새롭게 출시될 가능성이 있다.",           # market_q1 -> I
        "제품과 관련된 법·제도적 환경변화가 내 사업에 유리하다.", # market_q2 -> I
        "제품과 관련된 소비자 트렌드 변화가 내 사업에 유리하다.", # market_q3 -> I
        "제품과 관련된 경제적 변화가 내 사업에 유리하다.",      # market_q4 -> I
        "사업아이템 출시시장의 현재 추정규모는 얼마인지 알고있다.",  # market_q5 -> I
        "사업아이템 출시 시장의 기대되는 연평균성장률(향후 3년)은 얼마인지 알고 있다.",  # market_q6 -> I
        "나는 사업아이템과 관련된 예상고객과 만난 경험이 있다.",   # market_q7 -> I
        "나는 사업아이템과 관련된 예상유통업자와 만난 경험이 있다.", # market_q8 -> I
        "나는 사업아이템과 관련된 경쟁업체와 접촉(전화, 이메일, 방문 등)한 적이 있다.", # market_q9 -> I
        "나는 사업아이템과 관련된 시제품생산 업체와 만난 적이 있다.",  # market_q10 -> I
        "내 제품을 구매해줄 목표고객층을 결정하였다.",          # market_q11 -> S
        "내 제품을 구매해줄 핵심고객을 확보하였다. 알고 있는 편이다." # market_q12 -> S
    ]

    market_scores = {}
    for i, q in enumerate(market_questions, start=1):
        market_scores[f"market_q{i}"] = st.radio(q, [1, 2, 3, 4, 5], index=2, key=q)

    # (C) 아이템분석
    st.subheader("C) 아이템분석")
    item_questions = [
        "나의 제품은 경쟁자가 모방하기 어렵다.",         # item_q1 -> R
        "나는 판매목적의 시제품개발을 진행하고 있다.",      # item_q2 -> R
        "나의 제품은 기존 제품보다 가격 경쟁력이 있다.",     # item_q3 -> R
        "나의 제품은 기존 제품의 기능이나 성능을 개선하고 있다.", # item_q4 -> R
        "나는 기존 제품의 기능이나 성능을 개선할 수 있는 핵심기술을 가지고 있다.", # item_q5 -> R
        "나는 후속 제품을 만들 계획이 있다.",           # item_q6 -> S
        "나는 제품과 유사한 제품의 생산경험이 있다.",      # item_q7 -> E
        "나는 기술 발전의 트렌드(로드맵)를 알고 있다.",     # item_q8 -> E
        "나는 기술협력파트너를 확보하고 있다.",          # item_q9 -> R
        "나는 고객을 늘릴 수 있는 방법을 알고 있다.",      # item_q10 -> S
        "나는 고객이 누구인지 알고 있다.",             # item_q11 -> S
        "나는 고객이 느끼는 제품의 문제점을 파악하고 있다.",  # item_q12 -> S
        "나는 고객이 받는 기존 제품에 비해 추가적인 혜택을 제공하고 있다." # item_q13 -> S
    ]

    item_scores = {}
    for i, q in enumerate(item_questions, start=1):
        item_scores[f"item_q{i}"] = st.radio(q, [1, 2, 3, 4, 5], index=2, key=q)

    # (D) 비즈니스모델
    st.subheader("D) 비즈니스모델")
    bm_questions = [
        "나는 경쟁자가 어떤 방식으로 돈을 벌고 있는지를 알고 있다.", # bm_q1 -> S
        "나는 나의 사업아이템이 어떤 방식으로 돈을 벌 수 있는지 알고 있다.", # bm_q2 -> S
        "수익을 발생시키는 원천(제품판매, 서비스판매(수수료) 등)을 알고 있다.", # bm_q3 -> S
        "나는 제품생산관련 협력파트너를 확보하고 있다.",         # bm_q4 -> R
        "제품 생산과정을 전체적으로 파악하고 있다."             # bm_q5 -> R
    ]

    bm_scores = {}
    for i, q in enumerate(bm_questions, start=1):
        bm_scores[f"bm_q{i}"] = st.radio(q, [1, 2, 3, 4, 5], index=2, key=q)

    # (E) 전략
    st.subheader("E) 전략")
    strategy_questions = [
        "제품을 생산할 때 생산할 수량을 결정하였다.",         # strategy_q1 -> S
        "제품생산을 대행할 외주업체를 결정하였다.",           # strategy_q2 -> S
        "생산과정에서 발생할 수 있는 애로사항을 파악하고 있다.",   # strategy_q3 -> S
        "회사운영시 자문을 받을 수 있는 인적 네트워크를 충분히 확보하고 있다.", # strategy_q4 -> R
        "참여인력의 역할과 책임은 명확히 설정되어 있다.",        # strategy_q5 -> R
        "향후 2년간 분기별 매출액을 예측하고 있다.",           # strategy_q6 -> S
        "유통경로(중간유통, 직접판매 등)를 잘 알고 있다.",      # strategy_q7 -> S
        "제품 판매에 따른 수익구조(판매, 수수료, 이용료, 회비 등)는 명확하다.", # strategy_q8 -> S
        "자금운용계획은 수립되어 있다."                    # strategy_q9 -> S
    ]

    strategy_scores = {}
    for i, q in enumerate(strategy_questions, start=1):
        strategy_scores[f"strategy_q{i}"] = st.radio(q, [1, 2, 3, 4, 5], index=2, key=q)

    # ------------------
    # 3) 참여 희망 응답 조사
    # ------------------
    st.subheader("참여 희망 응답 조사")
    st.markdown("2024년 단국대학교 초기창업패키지 프로그램 참여 희망 여부를 선택해주세요.")

    program_interests = {
        "d_popup": st.checkbox("D-팝업Showing - 체험형 POP-UP전시, 홍보, 판로처 확보"),
        "d_tech": st.checkbox("D-Tech 이노베이션 - 대·중견·중소기업 인프라 활용 오픈이노베이션"),
        "ir_master": st.checkbox("IR Master Strategy - 투자교육, IR작성, 컨설팅"),
        "d_invest": st.checkbox("D-투자 Meet Up Day - 투자유치 협의체 구축 및 IR"),
        "startup_traction": st.checkbox("스타트업 트랙션 Fit - BM, 기술, 시장 등 전문가 매칭"),
        "d_blackfriday": st.checkbox("D-블랙프라이데이 - 제품프로모션을 통한 시장검증 및 개선"),
        "global_edu": st.checkbox("글로벌 진출 교육 및 컨설팅 - 글로벌 역량 강화, IR피치덱 클리닉"),
        "global_market": st.checkbox("글로벌 시장검증 - 해외 전시회 참가, 투자매칭 지원")
    }
    other_program = st.text_input("기타 희망 프로그램이 있다면 작성해주세요")

    # 자유의견
    st.subheader("자유의견")
    free_opinion = st.text_area("초기창업패키지 사업성과 향상을 위한 자유의견을 작성해주세요", height=100)

    # ------------------
    # 제출하기
    # ------------------
    submitted = st.form_submit_button("제출하기")

# ----------------------
# 4) 제출 시 분석 로직
# ----------------------
if submitted:
    # 간단한 유효성 검사
    if not name or not startup_item:
        st.error("필수 항목(이름, 창업아이템 등)을 입력해주세요.")
    else:
        st.success("설문이 정상적으로 제출되었습니다! 아래 진단 결과를 참고해주세요.\n")

        # 모든 점수를 하나의 dict에 합침
        all_scores = {}
        all_scores.update(ceo_scores)
        all_scores.update(market_scores)
        all_scores.update(item_scores)
        all_scores.update(bm_scores)
        all_scores.update(strategy_scores)

        # ERIS 영역별 점수 합산 및 개수
        domain_sum = {"E":0, "R":0, "I":0, "S":0}
        domain_count = {"E":0, "R":0, "I":0, "S":0}

        for q_key, score in all_scores.items():
            dom = domain_map.get(q_key, None)  # E/R/I/S
            if dom in domain_sum:
                domain_sum[dom] += score
                domain_count[dom] += 1

        # 평균 점수 계산(단순 평균)
        domain_avg = {}
        for d in domain_sum:
            if domain_count[d] > 0:
                domain_avg[d] = domain_sum[d] / domain_count[d]
            else:
                domain_avg[d] = 0.0

        # 창업단계에 따른 AHP 가중치(예시)
        # 논문(창업기): E=0.52, R=0.19, I=0.16, S=0.13
        # 논문(성장기): E=0.33, R=0.29, I=0.21, S=0.17
        # 여기서는 "준비/실행단계"를 창업기로, "성장단계"를 성장기로 가정
        if "성장단계" in st_stage:
            w_E, w_R, w_I, w_S = 0.33, 0.29, 0.21, 0.17
            stage_label = "성장기"
        else:
            w_E, w_R, w_I, w_S = 0.52, 0.19, 0.16, 0.13
            stage_label = "창업기(준비/실행)"

        # 가중 평균 점수
        weighted_score = (domain_avg["E"]*w_E + 
                          domain_avg["R"]*w_R + 
                          domain_avg["I"]*w_I + 
                          domain_avg["S"]*w_S )

        # --------------------------
        # 결과 화면에 표시
        # --------------------------
        st.markdown("## 진단 결과")
        st.write(f"**현재 창업단계**: {st_stage} → 논문기준 '{stage_label}' 가중치 적용")

        # 예시 해석 로직 (단순 기준)
        # - 평균 3.5 이상 → 상대적 강점
        # - 평균 2.5~3.5 → 보통
        # - 평균 2.5 미만 → 취약
        def interpret_score(domain, score):
            if score >= 3.5:
                return f"- **{domain}** 영역은 상대적으로 **강점**입니다."
            elif score >= 2.5:
                return f"- **{domain}** 영역은 보통 수준이나, 개선 여지가 있습니다."
            else:
                return f"- **{domain}** 영역은 **취약**하므로, 우선적으로 보완이 필요합니다."

        # 영역별 원점수(평균) 출력
        st.write("### 1) ERIS 영역별 평균점수 (1~5점 기준)")
        st.write(f"- E(창업가): {domain_avg['E']:.2f}, {interpret_score('창업가(E)', domain_avg['E'])}")
        st.write(f"- R(자원)  : {domain_avg['R']:.2f}, {interpret_score('자원(R)', domain_avg['R'])}")
        st.write(f"- I(산업)  : {domain_avg['I']:.2f}, {interpret_score('산업(I)', domain_avg['I'])}")
        st.write(f"- S(전략)  : {domain_avg['S']:.2f}, {interpret_score('전략(S)', domain_avg['S'])}")

        # 가중점수(최종)
        st.markdown(f"### 2) 종합 가중 점수 = {weighted_score:.2f} / 5.0")
        st.caption("(5점 만점 기준)")

        # 간단 코멘트: 창업단계별 중점 사항 안내
        if stage_label == "창업기(준비/실행)":
            st.info("""
            **창업기(준비/실행 단계)**에서는 
            - 창업가 역량(E)의 중요도가 50% 이상입니다.  
            - 기술/제품(자원)과 시장(산업) 이해도도 적절히 필요합니다.
            - 전략(S)은 프로토타입/시제품 단계에서의 피드백 수렴, 수익모델 검증에 초점.
            """)
        else:
            st.info("""
            **성장기**에서는 
            - 조직확장, 팀빌딩, 자금유치, 본격 판매전략 등 자원(R)과 전략(S)의 중요도가 더 높습니다.
            - 시장 교섭력(I)도 함께 키워야 안정적인 성장을 도모할 수 있습니다.
            """)

        # 선택된 체크박스(프로그램) 출력
        st.markdown("### 3) 참여 희망 프로그램")
        program_labels = {
            "d_popup": "D-팝업Showing - 체험형 POP-UP전시, 홍보, 판로처 확보",
            "d_tech": "D-Tech 이노베이션 - 대·중견·중소기업 인프라 활용 오픈이노베이션",
            "ir_master": "IR Master Strategy - 투자교육, IR작성, 컨설팅",
            "d_invest": "D-투자 Meet Up Day - 투자유치 협의체 구축 및 IR",
            "startup_traction": "스타트업 트랙션 Fit - BM, 기술, 시장 등 전문가 매칭",
            "d_blackfriday": "D-블랙프라이데이 - 제품프로모션을 통한 시장검증 및 개선",
            "global_edu": "글로벌 진출 교육 및 컨설팅 - 글로벌 역량 강화, IR피치덱 클리닉",
            "global_market": "글로벌 시장검증 - 해외 전시회 참가, 투자매칭 지원"
        }
        
        chosen_programs = [program_labels[k] for k,v in program_interests.items() if v]
        if chosen_programs:
            st.write("**선택한 프로그램:**")
            for program in chosen_programs:
                st.write(f"- {program}")
        else:
            st.write("선택한 프로그램이 없습니다.")

        # 자유 의견도 함께 보여주기
        if free_opinion:
            st.markdown("#### (자유의견)")
            st.write(free_opinion)

        # -----------------------------
        # 1점/5점 응답 문항 추출
        # -----------------------------
        lowest_questions = [q for q, score in all_scores.items() if score == 1]
        highest_questions = [q for q, score in all_scores.items() if score == 5]

        # 질문 텍스트로 매핑
        low_texts = [f"({q}) {question_texts[q]}" for q in lowest_questions]
        high_texts = [f"({q}) {question_texts[q]}" for q in highest_questions]

        # -----------------------------
        # GPT 프롬프트 구성
        # -----------------------------
        system_prompt = f"""
        논문 결과에 따르면, 
        1) 창업기에는 E(창업가:52%)>R(19%)>I(16%)>S(13%) 순으로 중요하며,
           - 창업가정신/특수역량/인적자원/기술자원/혁신 등이 핵심
        2) 성장기에는 E(33%)>R(29%)>I(21%)>S(17%) 이며, 
           - 일반역량/조직자원/교섭력/자원기반전략 등이 더 중요
        아래 정보를 참고하여, 사용자의 취약/강점 분야와 발전전략을 리포트 형태로 요약/조언해주세요.
        """

        user_prompt = f"""
        이름(기업명): {name}
        비즈니스 모델: {business_model}
        창업아이템: {startup_item}
        자유의견: {free_opinion}

        현재 창업단계: {stage_label}
        ERIS 평균점수: 
          - E(창업가)={domain_avg['E']:.2f}
          - R(자원)={domain_avg['R']:.2f}
          - I(산업)={domain_avg['I']:.2f}
          - S(전략)={domain_avg['S']:.2f}

        종합가중점수: {weighted_score:.2f} / 5

        [1점(매우 아니다)로 응답한 문항]
        {low_texts}

        [5점(매우 그렇다)로 응답한 문항]
        {high_texts}

        위 사항을 바탕으로 구체적 조언을 부탁드립니다.
        """

        # 실제 GPT API 호출 예시(실행 시 openai 라이브러리와 키 필요)
        # ------------------------------------------------------------
        client = OpenAI()


        # 답변
        st.markdown("### 4) AI 분석 창업기업의 현수준과 발전방안")
        
        with st.spinner('AI가 분석 중입니다...'):
            completion = client.chat.completions.create(
                model="gpt-4o",
                messages=[
                    {"role": "system", "content": system_prompt},
                    {
                        "role": "user",
                        "content": user_prompt
                    }
                ]
            )

            print(completion.choices[0].message)
            st.write(completion.choices[0].message.content)

        system_prompt = f"""아래의 내용을 모두 참고하여, 사용자가 입력한 정보를 바탕으로 친근하고 구체적인 사업적 조언을 총 3개 제공해줘. AI가 아니라 진짜 사람이 하는 것처럼 자연스럽게.

        #### 창업기 창업가(E)요인에 대한 창업가 의견  
**창업기의 창업가(E)**  
▸창업기에는 창업가의 개인기에 의존하는 면이 크다. 자원이 중요하지만 부족할 수 밖에 없고 파트너를 활용하는 부분이 중요하다. 돈이 안된다는 분위기 속에서도 창업가의 평판과 인사이트로 좋은 인력을 모집할 수 있었다. (첫\*, 대표)  
▸정신적 지주가 중요하다. 그 지주가 있으면 안정감을 느끼고, 그 사람과 함께라면 성공할 것 같은 믿음이 생긴다.(알\***, 대표)  
▸성공의 길은 단기간의 열정만으로는 극복할 수 없는 도전이 많다. 10년 동안 함께 고생한 팀의 절박함과 끈기, 그리고 지속적인 수익 창출을 위한 명확한 비전이 성공의 기반이었다. 창업가로서 끊임없는 판단력, 확신, 신속한 의사결정, 그리고 실행력이 필수적이다. 진심으로 창업을 추구한다면, 장기적인 관점에서 준비하고 그 도전을 받아들일 준비가 돼야 한다.(크\***, 대표)  
▸창업가의 배경의 경우 창업기의 투자나 채용 시 이점이 작용하는 것은 확실하지만, 결정적이라고 보기는 힘들고, 성장할수록 그 중요도는 떨어진다.(씨*****, 대표)  

---

#### 창업가의 역할에 대한 창업가 의견  
**성장기의 창업가(E) 역할**  
▸창업 초기에는 제품과 아이디어에 집중하며 모든 것을 직접 관리했지만, 성장기에는 전략적 리더십과 팀 관리에 더 많은 시간을 할애하게 되었습니다. 이제 제 역할은 비전 설정과 조직의 방향성을 제시하는 것입니다. (써\**, 대표)  
▸처음엔 그냥 원 오브 개발자였어요. 모든 작은 세부사항이 중요했지만, 성장기에 접어들면서 나는 큰 그림을 그리는데에 집중하게 되더라구요. 지금은 리서치, 육성과 같은 조직의 장기적 성장을 위해 시장 기회를 포착하고, 적절한 인재를 영입하고 길러내는 데 더 많은 노력을 기울여요.(테\**, 대표)  
▸초기에는 제 역할이 주로 문제 해결자였지만, 성장기에는 방향 제시자로 변모했습니다. 성공적인 성장을 위해 조직 문화를 구축하고, 팀을 영감을 주는 방향으로 이끌어가는 것이 제 새로운 목표입니다.(라\**, 대표)  

---

#### 자원(R)요인에 대한 창업가 의견  
**자원(R)**  
▸사무실 좋은 것도 중요하지만 업무와 커뮤니케이션 프로세스 등의 조직 프로세스가 중요합니다. 조직문화일 수도 있지만 약속?, 룰? 정해진 프로세스로인데, 이것도 제가 좋으니까 이렇게 하자 저렇게 하자가 아니라 형태를 잘 만드는 것인데, 사실은 저희도 트라이얼 에러를 통해 맞춰가고 있는 과정입니다. 직원들한테 회사가 완벽하지 않고 지금 투자 받은 만큼 성장하고 있는 상황이기에 개선해야할 부분을 얘기해 주면 같이 협의해서 한번 만들어보자는 얘기를 많이 합니다. 굉장히 심혈을 기울이고 좋은 프로세스들을 정성들여서 만들고 있어요.(더\**, 대표)  
▸긍정에너지를 발산을 하면서 달려가던 부분들을 스스로 표준화시키고 리스크 관리가 가능한 관리시스템을 설계를 해 나가는 시기가 성장기인 것 같습니다. 그걸 성장기에 만들어낸 회사가 그다음 단계로 가고 그거를 못 만들어낸 회사들이 무너진 경우들을 상당히 봤거든요.(씨*****, 대표)  
▸처음에는 단순한 비즈니스 아이디어였지만, 그 이후로 점점 커지고 성장해가는 과정에서 조직문화의 중요성을 깨닫게 되었습니다. 회사가 오래 지속되기 위해서는 경영 철학과 가치관이 꼭 필요하다는 것을 깨닫게 되었습니다. 그래서 저희는 비전과 철학을 담은 웨이(way)를 만들어 회사의 핵심 가치와 철학을 내재화하고자 했습니다.”(라\**, 대표)  

---

#### 성장율에 대한 창업가 의견  
**산업(I)의 성장율**  
▸창업기를 지나서 이제 성장기로 돌아섰을 때는 성장률이 급격히 올라가야 하는데 산업의 흐름이 우리의 성장과 맞지 않거나 애초에 산업 자체가 너무 작다면 아무리 뛰어난 인재와 전략이 있어도 생산성이 떨어질 수 밖에 없어요. 매출 100억을 만드는 것과 매출 천억을 만드는 것, 매출 10억을 만드는 건 똑같은 노력이거든요.(아*********, 대표)  
▸저희는 인공지능과 자원순환 산업 이런 전체적인 시장의 변화와 트렌드에 민감하게 생각하면서 조금 미리 움직인 부분이 굉장히 중요했어요. 성공에 올라가는 데, 제이커브를 만들어가는 데 말 그대로 판이 벌어지기 전에, 파티가 시작되기 조금 전에 미리 입장을 하는 거죠.(에****, 대표)  
▸창업멤버들이 산업에 대해서 타겟팅 한 게 좀 컸어요. 결국 진짜 올 시장이야라는 것에 대한 동행이 필요한 것 같아요(나****, 대표)  
▸유사한 서비스들이 있었음에도 이렇게 피봇을 한 이유는 이 시장이 엄청 커진다라고 생각했어요. 그래서 투자를 받는 데 유리하다고 생각했거든요.(디*****, 대표)  
▸메타가 오큘러스를 인수한다는 기사를 보고 VR이 곧 커질 것이라는 확신을 했어요. 그러면 누군가는 3D 컨텐츠를 만들어야 되는데 쉽게 만드는 게 최고일 거라 생각하고 시작한 거예요.(더\**, 대표)  

---

#### 경쟁에 대한 창업가 의견  
**산업(I)의 경쟁강도**  
▸기술적인 자신이 있고 확신이 있으면 경쟁도는 중요하지 않다. 미안하지만 경쟁사는 신경도 안 썼다. 경쟁사들과도 얘기 많이 했다. 그러면서 더 확신이 들었던 것 같다. 우리가 여기 정도는 잡을 수 있겠구나.(첫\*, 대표)  
▸파편화된 시장에서 퍼스트무버로 대중화에 성공하면, 경쟁자가 나와도 원천적인 시장 창출자로서 수익을 독점하고 큰 경쟁을 피할 수 있다.(크\***, 대표)  
▸경쟁사가 시장을 같이 키워주는 파트너란 생각이 들어요. 성숙이 됐을 때 경쟁을 하는 거지 시장이 커질 때는 좋은 파트너죠. 경쟁사 대표님 자주 봅니다. 그거 신경 쓰는 게 시간 낭비라고 생각합니다. 경쟁적으로 보는 게 아니고 그냥 절대적으로 우리 자체가 그냥 성장한다는 느낌이에요.(아********, 대표)  
▸유사 서비스가 다 마켓 점유율이 없기에 저는 의미가 없다고 생각합니다. 성장기에도 크게 의미가 없는 게 시장을 찢어 먹는 게 아니라 같이 파이를 키워나간다는 된다는 관점이 더 커요.(라\**, 대표)  
▸이종통합이라는 장르에서는 저희만 있었어요. 인수한 배경도 그게 제일 클 것 같아요. 전략적으로 지금 현재보다 길게 봤던게 통했어요“(알*****, 대표)  

---

#### 전략(S)에 대한 창업가 의견  
**전략(E)**  
▸제도 부분에서도 혁신이 필요하며, 처음으로 그 제도를 돌파한 제품으로 혁신이 중요하다. 이를 통해 창업기의 우위를 가질 수 있다..(알\***, 대표)  
산업이 크게 변동했지만 구체적인 전략은 없었다. 초기에는 빠른 실행과 현장 의사결정이 중요했으며, 계속 변하는 우선순위에 유연하게 대응했다.(나****, 대표)  
▸연간플랜이 아예 없었다. 너무 빨리 변하니까. 플랜을 세울 수가 없고 그냥 늘 바뀐다고 봐야한다. 성장기 한 2~3년 그렇게 보냈다.(크\***, 대표)  
▸초기에는 기술적인 혁신을 만들어내는 것이 제일 중요했고 그다음에 경쟁사 대비 어떤 차별점을 만들어내는 것이 중요했어요.(매****, 대표)  
▸온라인의 세계에서 오프라인만의 전략을 선택한 것은, 잊지 못할 경험에서 비롯되었어요. 어느날 매장을 찾아와 제품을 꼼꼼히 만져보고 체험한 뒤 구매하는 모습을 보는 순간, 제품의 질감, 착용감, 그리고 그것을 체험하는 고객의 반응, 그 모든 것이 오프라인만의 가치라는 것을 깨달았어요.(슈\**, 대표)  

---

#### 간절함에 대한 창업가 의견  
**창업가(E) 특징**  
▸포기하면 습관이 되는 걸 깨달았어요. 그래서 무엇이든 포기하면 안 된다는 생각으로 26세에 창업했어요. 부족함이 있었기 때문에 그걸 채우려고 노력했고, 여기까지 올 수 있었어요.(라****, 대표)  
▸창업기에는 창업가 개인기에 의존한 면이 커요. 10년 넘게 고생한 팀이어서 성공에 대한 절박함이 정말 간절했어요.(크\***, 대표)  
▸첫 창업은 유통 회사였는데, 코로나 때, 큰 타격을 받고 힘들어졌고, 결국 회사를 정리했어요. 포기하지 않고 다시 창업했는데, 잘 한 것 같아요.(오****, 대표)  
▸창업기에는 아이템보다 생존이 먼저였습니다. 젊은 시절 사업판에 발을 들이며 여러 실패를 겪은 후, 금전적 어려움을 겪었어요. 그러나 개발에 대한 열정과 기술은 변하지 않았고, 준비되면 그 때 사업을 시작하자는 생각으로 프리랜서로서의 길을 시작했습니다.(알*****, 대표)  

---

#### 기타 창업가 의견  
**기타 창업가 의견**  
▸보통 창업을 할 때 이 아이디어는 자기만 갖고 있을 거라고 생각을 하거든요. 그건 틀린 얘기예요. 수만 명이 비슷한 생각을 해요. 실행 하는지 안 하는지, 얼마큼 빠르게 하는지에 성공이 결정된다고 생각해요.(오****, 대표)  
▸누가 하고 있네 하면서 쉽게 버리는 경우가 많은데 하고 있다면 그 아이디어가 괜찮다는 얘기에요. 오히려 빠르게 따라 하다 보면 금방 따라잡을 수 있고, 안 하고 있는 것들을 좀 더 깊이 있게 공략을 하면 되는거죠,(매****, 대표)  
▸성장하는 시장에 들어가는 편이라 글로벌 리서치를 많이 해요. 해외에서 뜨는 서비스를 유심히 봐요 미국인과 한국인 사이에 큰 차이가 없으면 미국에서 되는 게 한국에서도 되겠죠. 빠르게 벤치마킹을 해요(테\**, 대표)  
▸목표를 명확히 세우고 그를 위해 모든 역량을 집중하는 것이 중요해요. 저희는 매각을 목적으로 서비스 시작한 거예요.(라\**, 대표)"""

        st.markdown("### 5) 성공한 창업가들의 조언")
        with st.spinner("AI 조언 생성 중..."):
            completion = client.chat.completions.create(
                model="gpt-4o",
                messages=[
                    {"role": "system", "content": system_prompt},
                    {
                        "role": "user", 
                        "content": user_prompt
                    }
                ]
            )   
            st.write(completion.choices[0].message.content)
            
            print(completion.choices[0].message)

        
        st.success("감사합니다! 위 결과와 문항별 응답을 바탕으로 추가 컨설팅 및 맞춤형 지원을 이어가겠습니다.")
